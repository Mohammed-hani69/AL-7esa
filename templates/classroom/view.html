<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ classroom.name }} - الحصة</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/teacher/teacher.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/classroom/classroom.css') }}">
</head>
<body>
<div class="wrapper">
    <!-- الشريط الجانبي -->
    <aside class="sidebar">
        <div class="sidebar-brand">
            <img src="{{ url_for('static', filename='img/logo.png') }}" width="40" height="40" class="d-inline-block align-top ms-2" alt="الحصة" onerror="this.src='https://via.placeholder.com/40?text=AL'">
            <span class="sidebar-brand-text">الحصة</span>
        </div>

        <hr class="sidebar-divider">

        <ul class="nav-list">
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('teacher.dashboard') }}">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>لوحة التحكم</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link active" href="{{ url_for('teacher.dashboard') }}">
                    <i class="fas fa-chalkboard"></i>
                    <span>الفصول</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('teacher.students') }}">
                    <i class="fas fa-user-graduate"></i>
                    <span>الطلاب</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('teacher.assignments') }}">
                    <i class="fas fa-tasks"></i>
                    <span>الواجبات</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('teacher.quizzes') }}">
                    <i class="fas fa-clipboard-list"></i>
                    <span>الاختبارات</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('teacher.content') }}">
                    <i class="fas fa-book"></i>
                    <span>المحتوى</span>
                </a>
            </li>

            <hr class="sidebar-divider">

            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('auth.profile') }}">
                    <i class="fas fa-user-circle"></i>
                    <span>الملف الشخصي</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('auth.logout') }}">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>تسجيل الخروج</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- المحتوى الرئيسي -->
    <div class="content-wrapper">
        <div class="topbar">
            <nav class="navbar">
                <button id="sidebarToggleBtn" class="btn">
                    <i class="fas fa-bars"></i>
                </button>

                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="notificationsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-bell"></i>
                            {% if current_user.notifications|selectattr('is_read', 'equalto', false)|list|length > 0 %}
                            <span class="badge bg-danger badge-counter">{{ current_user.notifications|selectattr('is_read', 'equalto', false)|list|length }}</span>
                            {% endif %}
                        </a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationsDropdown">
                            <h6 class="dropdown-header">الإشعارات</h6>
                            {% if current_user.notifications %}
                                {% for notification in current_user.notifications|sort(attribute='created_at', reverse=true)|slice(0, 5) %}
                                <a class="dropdown-item {{ '' if notification.is_read else 'fw-bold' }}" href="#">
                                    <span class="small text-muted">{{ notification.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                                    <p class="mb-0">{{ notification.message }}</p>
                                </a>
                                {% endfor %}
                            {% else %}
                                <a class="dropdown-item text-center" href="#">لا توجد إشعارات</a>
                            {% endif %}
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-center small text-muted" href="#">عرض كل الإشعارات</a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="ms-2 d-none d-lg-inline text-gray-600 small">{{ current_user.name }}</span>
                            {% if current_user.profile_picture %}
                            <img class="img-profile rounded-circle" src="{{ current_user.profile_picture }}" width="36" height="36" alt="{{ current_user.name }}">
                            {% else %}
                            <img class="img-profile rounded-circle" src="{{ url_for('static', filename='img/default-profile.png') }}" width="36" height="36" alt="{{ current_user.name }}" onerror="this.src='https://via.placeholder.com/36?text=User'">
                            {% endif %}
                        </a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <a class="dropdown-item" href="{{ url_for('auth.profile') }}">
                                <i class="fas fa-user-circle ms-2"></i>
                                الملف الشخصي
                            </a>
                            <a class="dropdown-item" href="#">
                                <i class="fas fa-cogs ms-2"></i>
                                الإعدادات
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="{{ url_for('auth.logout') }}">
                                <i class="fas fa-sign-out-alt ms-2"></i>
                                تسجيل الخروج
                            </a>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- إشعارات النظام -->
        <div class="flash-messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>

        <!-- البنرات الإعلانية -->
        {% if banners %}
        <div class="banners-container mb-4">
            <div id="bannersCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
                <div class="carousel-inner">
                    {% for banner in banners %}
                    <div class="carousel-item {% if loop.first %}active{% endif %}">
                        <div class="banner-image-container">
                            {% if banner.link_url %}
                            <a href="{{ banner.link_url }}" {% if banner.is_external %}target="_blank"{% endif %}>
                                <img src="{{ banner.image_url }}" alt="{{ banner.title }}" class="banner-full-image">
                            </a>
                            {% else %}
                            <img src="{{ banner.image_url }}" alt="{{ banner.title }}" class="banner-full-image">
                            {% endif %}
                            <button type="button" class="btn-close btn-close-white" onclick="dismissBanner({{ banner.id }})" aria-label="إغلاق"></button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if banners|length > 1 %}
                <button class="carousel-control-prev" type="button" data-bs-target="#bannersCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">السابق</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#bannersCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">التالي</span>
                </button>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- محتوى عرض الفصل -->
        <div class="classroom-content">
            <div class="container-fluid">
                <!-- ترويسة معلومات الفصل -->
                <div class="classroom-header mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="classroom-title">{{ classroom.name }}</h1>
                            <div class="classroom-meta">
                                <span class="badge bg-primary me-2">{{ classroom.subject }}</span>
                                <span class="badge bg-secondary me-2">{{ classroom.grade }}</span>
                                <span class="badge bg-info">{{ classroom.academic_year }}</span>
                            </div>
                            <p class="classroom-description mt-2">
                                {{ classroom.description or 'لا يوجد وصف للفصل.' }}
                            </p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <div class="classroom-actions">
                                <a href="{{ url_for('teacher.live_class', classroom_id=classroom.id) }}" class="btn btn-danger">
                                    <i class="fas fa-video me-1"></i> بدء حصة مباشرة
                                </a>
                                <button type="button" class="btn btn-outline-primary ms-2" data-bs-toggle="modal" data-bs-target="#shareClassModal">
                                    <i class="fas fa-share-alt me-1"></i> مشاركة
                                </button>
                            </div>
                            <div class="classroom-code mt-3">
                                <span class="fw-bold">كود الفصل:</span> 
                                <span class="code-display">{{ classroom.code }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- بطاقات التنقل السريع -->
                <div class="row mb-4">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card quick-nav-card h-100">
                            <div class="card-body text-center">
                                <div class="icon-circle bg-primary mb-3">
                                    <i class="fas fa-user-graduate text-white"></i>
                                </div>
                                <h5>الطلاب</h5>
                                <p class="card-text">{{ classroom.students|length }} طالب</p>
                                <a href="#students-tab" class="stretched-link" data-bs-toggle="tab" role="tab"></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card quick-nav-card h-100">
                            <div class="card-body text-center">
                                <div class="icon-circle bg-success mb-3">
                                    <i class="fas fa-tasks text-white"></i>
                                </div>
                                <h5>الواجبات</h5>
                                <p class="card-text">{{ assignments|length }} واجب</p>
                                <a href="#assignments-tab" class="stretched-link" data-bs-toggle="tab" role="tab"></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card quick-nav-card h-100">
                            <div class="card-body text-center">
                                <div class="icon-circle bg-info mb-3">
                                    <i class="fas fa-clipboard-list text-white"></i>
                                </div>
                                <h5>الاختبارات</h5>
                                <p class="card-text">{{ quizzes|length }} اختبار</p>
                                <a href="#quizzes-tab" class="stretched-link" data-bs-toggle="tab" role="tab"></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card quick-nav-card h-100">
                            <div class="card-body text-center">
                                <div class="icon-circle bg-warning mb-3">
                                    <i class="fas fa-chart-bar text-white"></i>
                                </div>
                                <h5>الإحصائيات</h5>
                                <p class="card-text">عرض التقارير</p>
                                <a href="#statistics-tab" class="stretched-link" data-bs-toggle="tab" role="tab"></a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- المحتوى المبوب -->
                <div class="card shadow mb-4">
                    <div class="card-header p-0">
                        <ul class="nav nav-tabs" id="classroomTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">نظرة عامة</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="students-tab" data-bs-toggle="tab" data-bs-target="#students" type="button" role="tab">الطلاب</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="attendance-tab" data-bs-toggle="tab" data-bs-target="#attendance" type="button" role="tab">الحضور والغياب</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="assignments-tab" data-bs-toggle="tab" data-bs-target="#assignments" type="button" role="tab">الواجبات</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="quizzes-tab" data-bs-toggle="tab" data-bs-target="#quizzes" type="button" role="tab">الاختبارات</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="content-tab" data-bs-toggle="tab" data-bs-target="#content" type="button" role="tab">المحتوى</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="statistics-tab" data-bs-toggle="tab" data-bs-target="#statistics" type="button" role="tab">الإحصائيات</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">الإعدادات</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="classroomTabContent">
                            <!-- قسم نظرة عامة -->
                            <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                                <div class="row">
                                    <div class="col-lg-8">
                                        <!-- الإعلانات والمنشورات -->
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                                <h6 class="m-0 font-weight-bold text-primary">الإعلانات</h6>
                                                <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#newAnnouncementModal">
                                                    <i class="fas fa-plus fa-sm"></i> إضافة إعلان
                                                </button>
                                            </div>
                                            <div class="card-body">
                                                {% if announcements %}
                                                <div class="announcements-list">
                                                    {% for announcement in announcements %}
                                                    <div class="announcement-item mb-4">
                                                        <div class="announcement-header d-flex align-items-center">
                                                            <div class="user-avatar me-3">
                                                                {% if announcement.user.profile_picture %}
                                                                <img src="{{ announcement.user.profile_picture }}" alt="{{ announcement.user.name }}" class="rounded-circle" width="40" height="40">
                                                                {% else %}
                                                                <img src="{{ url_for('static', filename='img/default-profile.png') }}" alt="{{ announcement.user.name }}" class="rounded-circle" width="40" height="40" onerror="this.src='https://via.placeholder.com/40?text=U'">
                                                                {% endif %}
                                                            </div>
                                                            <div class="user-info">
                                                                <h6 class="mb-0">{{ announcement.user.name }}</h6>
                                                                <small class="text-muted">{{ announcement.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                                                            </div>
                                                            <div class="ms-auto">
                                                                <div class="dropdown">
                                                                    <button class="btn btn-sm" type="button" data-bs-toggle="dropdown">
                                                                        <i class="fas fa-ellipsis-v"></i>
                                                                    </button>
                                                                    <div class="dropdown-menu dropdown-menu-end">
                                                                        <a class="dropdown-item" href="#">تعديل</a>
                                                                        <a class="dropdown-item text-danger" href="#">حذف</a>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="announcement-content mt-3">
                                                            <p>{{ announcement.content }}</p>
                                                            {% if announcement.attachment %}
                                                            <div class="attachment mt-2">
                                                                <a href="{{ url_for('static', filename='uploads/' + announcement.attachment) }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                                                                    <i class="fas fa-paperclip me-1"></i> {{ announcement.attachment }}
                                                                </a>
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                        <div class="announcement-actions mt-3">
                                                            <button class="btn btn-sm btn-outline-primary">
                                                                <i class="far fa-comment me-1"></i> {{ announcement.comments|length }} تعليق
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <hr>
                                                    {% endfor %}
                                                </div>
                                                {% else %}
                                                <div class="text-center py-4">
                                                    <p class="text-muted">لا توجد إعلانات بعد.</p>
                                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newAnnouncementModal">
                                                        <i class="fas fa-plus ms-1"></i> إضافة إعلان
                                                    </button>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <!-- الواجبات والاختبارات القادمة -->
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">المهام القادمة</h6>
                                            </div>
                                            <div class="card-body">
                                                {% if upcoming_tasks %}
                                                <div class="list-group">
                                                    {% for task in upcoming_tasks %}
                                                    <a href="#" class="list-group-item list-group-item-action">
                                                        <div class="d-flex w-100 justify-content-between">
                                                            <h6 class="mb-1">{{ task.title }}</h6>
                                                            <small>{{ task.due_date.strftime('%Y-%m-%d') }}</small>
                                                        </div>
                                                        <p class="mb-1 small">
                                                            {% if task.type == 'assignment' %}
                                                            <span class="badge bg-success">واجب</span>
                                                            {% else %}
                                                            <span class="badge bg-info">اختبار</span>
                                                            {% endif %}
                                                        </p>
                                                    </a>
                                                    {% endfor %}
                                                </div>
                                                {% else %}
                                                <p class="text-center text-muted">لا توجد مهام قادمة.</p>
                                                {% endif %}
                                            </div>
                                        </div>

                                        <!-- إحصائيات سريعة -->
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">إحصائيات الفصل</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="stats-item mb-3">
                                                    <div class="stats-header d-flex justify-content-between">
                                                        <span>نسبة حضور الطلاب</span>
                                                        <span>{{ attendance_rate }}%</span>
                                                    </div>
                                                    <div class="progress mt-2">
                                                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ attendance_rate }}%" aria-valuenow="{{ attendance_rate }}" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                </div>

                                                <div class="stats-item mb-3">
                                                    <div class="stats-header d-flex justify-content-between">
                                                        <span>معدل تسليم الواجبات</span>
                                                        <span>{{ submission_rate }}%</span>
                                                    </div>
                                                    <div class="progress mt-2">
                                                        <div class="progress-bar bg-info" role="progressbar" style="width: {{ submission_rate }}%" aria-valuenow="{{ submission_rate }}" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                </div>

                                                <div class="stats-item">
                                                    <div class="stats-header d-flex justify-content-between">
                                                        <span>متوسط الدرجات</span>
                                                        <span>{{ average_grade }}</span>
                                                    </div>
                                                    <div class="progress mt-2">
                                                        <div class="progress-bar bg-warning" role="progressbar" style="width: {{ (average_grade / 100) * 100 }}%" aria-valuenow="{{ (average_grade / 100) * 100 }}" aria-valuemin="0" aria-valuemax="100"></div>
                                                    </div>
                                                </div>

                                                <div class="text-center mt-4">
                                                    <a href="#statistics-tab" class="btn btn-sm btn-primary" data-bs-toggle="tab" role="tab">عرض التقارير المفصلة</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- قسم الطلاب -->
                            <div class="tab-pane fade" id="students" role="tabpanel" aria-labelledby="students-tab">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h5>الطلاب المسجلين ({{ classroom.students|length }})</h5>
                                    <div>
                                        <button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#exportStudentsModal">
                                            <i class="fas fa-file-export me-1"></i> تصدير
                                        </button>
                                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#inviteStudentsModal">
                                            <i class="fas fa-user-plus me-1"></i> دعوة طلاب
                                        </button>
                                    </div>
                                </div>

                                <div class="card shadow mb-4">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="studentsTable" width="100%" cellspacing="0">
                                                <thead>
                                                    <tr>
                                                        <th>الاسم</th>
                                                        <th>رقم الهاتف</th>
                                                        <th>البريد الإلكتروني</th>
                                                        <th>تاريخ الانضمام</th>
                                                        <th>النقاط</th>
                                                        <th>آخر تفاعل</th>
                                                        <th>الإجراءات</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for enrollment in classroom.students %}
                                                    <tr>
                                                        <td>
                                                            <div class="d-flex align-items-center">
                                                                {% if enrollment.student.profile_picture %}
                                                                <img src="{{ enrollment.student.profile_picture }}" class="rounded-circle me-2" width="32" height="32" alt="{{ enrollment.student.name }}">
                                                                {% else %}
                                                                <img src="{{ url_for('static', filename='img/default-profile.png') }}" class="rounded-circle me-2" width="32" height="32" alt="{{ enrollment.student.name }}" onerror="this.src='https://via.placeholder.com/32?text=S'">
                                                                {% endif %}
                                                                {{ enrollment.student.name }}
                                                            </div>
                                                        </td>
                                                        <td dir="ltr">{{ enrollment.student.phone }}</td>
                                                        <td>{{ enrollment.student.email or '-' }}</td>
                                                        <td>{{ enrollment.created_at.strftime('%Y-%m-%d') }}</td>
                                                        <td>{{ enrollment.points }}</td>
                                                        <td>{{ enrollment.last_activity.strftime('%Y-%m-%d %H:%M') if enrollment.last_activity else '-' }}</td>
                                                        <td>
                                                            <div class="btn-group">
                                                                <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#viewStudentModal-{{ enrollment.student.id }}">
                                                                    <i class="fas fa-eye"></i>
                                                                </button>
                                                                <button type="button" class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#messageStudentModal-{{ enrollment.student.id }}">
                                                                    <i class="fas fa-comment"></i>
                                                                </button>
                                                                <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#removeStudentModal-{{ enrollment.student.id }}">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                </div>
                            </div>

                            <!-- قسم الحضور والغياب -->
                            <div class="tab-pane fade" id="attendance" role="tabpanel" aria-labelledby="attendance-tab">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h5>نظام الحضور والغياب</h5>
                                    <div>
                                        <a href="{{ url_for('attendance.mark_attendance', classroom_id=classroom.id) }}" class="btn btn-primary me-2">
                                            <i class="fas fa-calendar-check me-1"></i>تسجيل حضور جديد
                                        </a>
                                        <a href="{{ url_for('attendance.attendance_report', classroom_id=classroom.id) }}" class="btn btn-info">
                                            <i class="fas fa-chart-bar me-1"></i>تقرير الحضور
                                        </a>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="m-0">آخر تسجيلات الحضور</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>التاريخ</th>
                                                                <th>عدد الحاضرين</th>
                                                                <th>عدد الغائبين</th>
                                                                <th>نسبة الحضور</th>
                                                                <th>الإجراءات</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <!-- سيتم تحميل البيانات هنا -->
                                                            <tr>
                                                                <td colspan="5" class="text-center text-muted">
                                                                    <i class="fas fa-calendar-times fa-2x mb-2"></i>
                                                                    <p>لا توجد تسجيلات حضور بعد</p>
                                                                    <a href="{{ url_for('attendance.mark_attendance', classroom_id=classroom.id) }}" class="btn btn-primary btn-sm">
                                                                        ابدأ تسجيل الحضور
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="m-0">إحصائيات الحضور</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="text-center">
                                                    <div class="mb-3">
                                                        <h4 class="text-success mb-1">85%</h4>
                                                        <small class="text-muted">متوسط نسبة الحضور</small>
                                                    </div>
                                                    <div class="progress mb-3" style="height: 10px;">
                                                        <div class="progress-bar bg-success" style="width: 85%"></div>
                                                    </div>
                                                    <div class="row text-center">
                                                        <div class="col-6">
                                                            <div class="border-end">
                                                                <h6 class="text-primary mb-0">12</h6>
                                                                <small class="text-muted">أيام الحضور</small>
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <h6 class="text-danger mb-0">3</h6>
                                                            <small class="text-muted">أيام الغياب</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="card mt-3">
                                            <div class="card-header">
                                                <h6 class="m-0">طلاب يحتاجون متابعة</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="text-center text-muted py-3">
                                                    <i class="fas fa-user-check fa-2x mb-2"></i>
                                                    <p class="mb-0">جميع الطلاب يحضرون بانتظام</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- قسم الواجبات -->
                            <div class="tab-pane fade" id="assignments" role="tabpanel" aria-labelledby="assignments-tab">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h5>الواجبات ({{ assignments|length }})</h5>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createAssignmentModal">
                                        <i class="fas fa-plus me-1"></i> إضافة واجب جديد
                                    </button>بات ({{ assignments|length }})</h5>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createAssignmentModal">
                                        <i class="fas fa-plus me-1"></i> إضافة واجب جديد
                                    </button>
                                </div>

                                <div class="card shadow mb-4">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="assignmentsTable" width="100%" cellspacing="0">
                                                <thead>
                                                    <tr>
                                                        <th>العنوان</th>
                                                        <th>تاريخ النشر</th>
                                                        <th>تاريخ الاستحقاق</th>
                                                        <th>الدرجة</th>
                                                        <th>عدد التسليمات</th>
                                                        <th>الحالة</th>
                                                        <th>الإجراءات</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for assignment in assignments %}
                                                    <tr>
                                                        <td>{{ assignment.title }}</td>
                                                        <td>{{ assignment.created_at.strftime('%Y-%m-%d') }}</td>
                                                        <td>{{ assignment.due_date.strftime('%Y-%m-%d') }}</td>
                                                        <td>{{ assignment.total_marks }}</td>
                                                        <td>{{ assignment.submissions|length }} / {{ classroom.students|length }}</td>
                                                        <td>
                                                            {% if assignment.is_active %}
                                                            <span class="badge bg-success">نشط</span>
                                                            {% else %}
                                                            <span class="badge bg-secondary">منتهي</span>
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            <div class="btn-group">
                                                                <a href="{{ url_for('teacher.view_assignment', assignment_id=assignment.id) }}" class="btn btn-sm btn-outline-primary">
                                                                    <i class="fas fa-eye"></i>
                                                                </a>
                                                                <a href="{{ url_for('teacher.edit_assignment', assignment_id=assignment.id) }}" class="btn btn-sm btn-outline-info">
                                                                    <i class="fas fa-edit"></i>
                                                                </a>
                                                                <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAssignmentModal-{{ assignment.id }}">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- قسم الاختبارات -->
                            <div class="tab-pane fade" id="quizzes" role="tabpanel" aria-labelledby="quizzes-tab">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h5>الاختبارات ({{ quizzes|length }})</h5>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createQuizModal">
                                        <i class="fas fa-plus me-1"></i> إنشاء اختبار جديد
                                    </button>
                                </div>

                                <div class="card shadow mb-4">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="quizzesTable" width="100%" cellspacing="0">
                                                <thead>
                                                    <tr>
                                                        <th>العنوان</th>
                                                        <th>تاريخ النشر</th>
                                                        <th>تاريخ الانتهاء</th>
                                                        <th>المدة (دقائق)</th>
                                                        <th>عدد الأسئلة</th>
                                                        <th>الدرجة الكلية</th>
                                                        <th>عدد المحاولات</th>
                                                        <th>الحالة</th>
                                                        <th>الإجراءات</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for quiz in quizzes %}
                                                    <tr>
                                                        <td>{{ quiz.title }}</td>
                                                        <td>{{ quiz.created_at.strftime('%Y-%m-%d') }}</td>
                                                        <td>{{ quiz.end_date.strftime('%Y-%m-%d') }}</td>
                                                        <td>{{ quiz.duration }}</td>
                                                        <td>{{ quiz.questions|length }}</td>
                                                        <td>{{ quiz.total_marks }}</td>
                                                        <td>{{ quiz.attempts|length }} / {{ classroom.students|length }}</td>
                                                        <td>
                                                            {% if quiz.is_active %}
                                                            <span class="badge bg-success">نشط</span>
                                                            {% else %}
                                                            <span class="badge bg-secondary">منتهي</span>
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            <div class="btn-group">
                                                                <a href="{{ url_for('teacher.view_quiz', quiz_id=quiz.id) }}" class="btn btn-sm btn-outline-primary">
                                                                    <i class="fas fa-eye"></i>
                                                                </a>
                                                                <a href="{{ url_for('teacher.edit_quiz', quiz_id=quiz.id) }}" class="btn btn-sm btn-outline-info">
                                                                    <i class="fas fa-edit"></i>
                                                                </a>
                                                                <a href="{{ url_for('teacher.quiz_results', quiz_id=quiz.id) }}" class="btn btn-sm btn-outline-success">
                                                                    <i class="fas fa-chart-bar"></i>
                                                                </a>
                                                                <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteQuizModal-{{ quiz.id }}">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- باقي الأقسام -->
                            <div class="tab-pane fade" id="content" role="tabpanel" aria-labelledby="content-tab">
                                <h5>محتوى الفصل</h5>
                                <!-- محتوى قسمالمحتوى هنا -->
                            </div>

                            <div class="tab-pane fade" id="statistics" role="tabpanel" aria-labelledby="statistics-tab">
                                <h5>إحصائيات الفصل</h5>
                                <!-- محتوى قسم الإحصائيات هنا -->
                            </div>

                            <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
                                <h5>إعدادات الفصل</h5>
                                <!-- محتوى قسم الإعدادات هنا -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- نماذج (modals) -->
<!-- يمكن إضافة النماذج مثل إضافة إعلان، دعوة طلاب، الخ هنا -->

<style>
.banners-container {
    margin: 2rem 0;
}

.banner-image-container {
    position: relative;
    width: 100%;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease;
}

.banner-image-container:hover {
    transform: translateY(-2px);
}

.banner-full-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    display: block;
    transition: transform 0.3s ease;
}

.banner-full-image:hover {
    transform: scale(1.02);
}

.banner-image-container a {
    display: block;
    text-decoration: none;
}

.banner-image-container .btn-close {
    position: absolute;
    top: 15px;
    right: 15px;
    z-index: 3;
    opacity: 0.8;
    transition: all 0.3s ease;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    width: 32px;
    height: 32px;
}

.banner-image-container .btn-close:hover {
    opacity: 1;
    transform: scale(1.1);
    background: rgba(0, 0, 0, 0.7);
}

.carousel-control-prev,
.carousel-control-next {
    width: 5%;
    color: rgba(255, 255, 255, 0.8);
}

.carousel-control-prev:hover,
.carousel-control-next:hover {
    color: white;
}

.carousel-indicators {
    bottom: -50px;
}

.carousel-indicators button {
    background-color: #667eea;
    border: none;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin: 0 5px;
}

.carousel-indicators button.active {
    background-color: #764ba2;
}

@media (max-width: 768px) {
    .banner-full-image {
        height: 150px;
    }
    
    .banner-image-container .btn-close {
        width: 28px;
        height: 28px;
        top: 10px;
        right: 10px;
    }
}
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script>
    // تبديل القائمة الجانبية
    document.addEventListener('DOMContentLoaded', function() {
        const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
        const sidebar = document.querySelector('.sidebar');
        const contentWrapper = document.querySelector('.content-wrapper');

        if (sidebarToggleBtn) {
            sidebarToggleBtn.addEventListener('click', function() {
                sidebar.classList.toggle('show');
            });
        }

        // وظائف القائمة المنسدلة
        const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
        dropdownToggles.forEach(toggle => {
            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                const dropdownMenu = this.nextElementSibling;
                if (dropdownMenu) {
                    dropdownMenu.classList.toggle('show');
                }
            });
        });

        // إغلاق القائمة المنسدلة عند النقر خارجها
        document.addEventListener('click', function(e) {
            if (!e.target.matches('.dropdown-toggle')) {
                const dropdowns = document.querySelectorAll('.dropdown-menu.show');
                dropdowns.forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
            }
        });

        // تفعيل الجداول
        if (typeof $.fn.DataTable !== 'undefined') {
            $('#studentsTable').DataTable({
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.10.25/i18n/Arabic.json"
                }
            });

            $('#assignmentsTable').DataTable({
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.10.25/i18n/Arabic.json"
                }
            });

            $('#quizzesTable').DataTable({
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.10.25/i18n/Arabic.json"
                }
            });
        }
    });

    // وظائف البنرات
    function dismissBanner(bannerId) {
        // إخفاء البنر محلياً
        const bannerElement = event.target.closest('.carousel-item');
        if (bannerElement) {
            bannerElement.style.display = 'none';
        }
        
        // إرسال طلب إلى الخادم لتسجيل الإخفاء
        fetch(`/api/banners/${bannerId}/dismiss`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken()
            },
            credentials: 'same-origin'
        }).catch(error => {
            console.error('Error dismissing banner:', error);
        });
    }

    function getCsrfToken() {
        const token = document.querySelector('meta[name="csrf-token"]');
        return token ? token.getAttribute('content') : '';
    }

    // تفعيل دوران البنرات التلقائي
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('bannersCarousel');
        if (carousel) {
            // بدء الدوران التلقائي كل 5 ثواني
            const bsCarousel = new bootstrap.Carousel(carousel, {
                interval: 5000,
                wrap: true
            });
        }
    });
</script>
</body>
</html>
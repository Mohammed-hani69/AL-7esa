<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Øª Ø¨Ø³ÙŠØ·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        #messagesArea {
            height: 400px;
            border: 1px solid #ccc;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
            background: #f9f9f9;
        }
        
        .message {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 8px;
            background: white;
            border-left: 3px solid #007bff;
        }
        
        .message.own {
            background: #e3f2fd;
            border-left-color: #4caf50;
        }
        
        #messageInput {
            width: 70%;
            padding: 10px;
        }
        
        #sendButton {
            width: 25%;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        
        .debug {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Øª Ø¨Ø³ÙŠØ·</h1>
    
    <div class="debug">
        <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø§Øª:</strong> <span id="status">ØªØ­Ù…ÙŠÙ„...</span>
    </div>
    
    <div id="messagesArea"></div>
    
    <div>
        <input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." />
        <button id="sendButton" onclick="testSendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
    
    <div class="debug">
        <h3>ØªØªØ¨Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:</h3>
        <div id="debugLog"></div>
    </div>

    <script>
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const currentUser = {
            id: "test_user_123",
            name: "Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ",
            role: "teacher"
        };
        
        const classroomId = "test_classroom_456";
        
        let messageCounter = 0;
        
        function log(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(status) {
            document.getElementById('status').textContent = status;
            log(`ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©: ${status}`);
        }
        
        function displayMessage(messageData) {
            log(`ğŸ“¥ Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø©: ${JSON.stringify(messageData)}`);
            
            const messagesArea = document.getElementById('messagesArea');
            if (!messagesArea) {
                log('âŒ Ø¹Ù†ØµØ± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }
            
            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
            const senderId = messageData.senderId || messageData.userId;
            const senderName = messageData.senderName || messageData.userName;
            const senderRole = messageData.senderRole || messageData.userRole;
            const messageText = messageData.text || messageData.message;
            
            if (!messageText || !senderId) {
                log('âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©');
                return;
            }
            
            // ØªØ¬Ù†Ø¨ Ø¹Ø±Ø¶ Ù†ÙØ³ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø±ØªÙŠÙ†
            const messageId = messageData.id || 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            if (document.querySelector(`[data-message-id="${messageId}"]`)) {
                log('âš ï¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                return;
            }

            const isOwnMessage = senderId === currentUser.id;

            const messageElement = document.createElement('div');
            messageElement.className = `message ${isOwnMessage ? 'own' : ''}`;
            messageElement.setAttribute('data-message-id', messageId);

            const timestamp = messageData.timestamp ? 
                new Date(messageData.timestamp).toLocaleTimeString('ar-EG', {
                    hour: '2-digit',
                    minute: '2-digit'
                }) : new Date().toLocaleTimeString('ar-EG', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

            messageElement.innerHTML = `
                <div><strong>${senderName}</strong> <small>(${senderRole})</small> - <small>${timestamp}</small></div>
                <div>${messageText}</div>
            `;

            messagesArea.appendChild(messageElement);
            messagesArea.scrollTop = messagesArea.scrollHeight;
            
            log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©');
        }
        
        function testSendMessage() {
            const messageInput = document.getElementById('messageInput');
            const messageText = messageInput.value.trim();
            
            if (!messageText) {
                log('âš ï¸ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±Øº');
                return;
            }
            
            log(`ğŸ“¤ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©: "${messageText}"`);
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
            const messageData = {
                id: 'test_msg_' + (++messageCounter),
                text: messageText,
                senderId: currentUser.id,
                senderName: currentUser.name,
                senderRole: currentUser.role,
                timestamp: new Date()
            };
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
            displayMessage(messageData);
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„
            messageInput.value = '';
            
            log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø´Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ');
            updateStatus('Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø¥Ù†ØªØ±
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    testSendMessage();
                }
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
            displayMessage({
                id: 'welcome_msg',
                text: 'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø³ÙŠØ· Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Øª.',
                senderId: 'system',
                senderName: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                senderRole: 'system',
                timestamp: new Date()
            });
            
            log('âœ… ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©');
        });
    </script>
</body>
</html>

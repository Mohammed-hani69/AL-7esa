# نظام نافذة إضافة المحفظة الإلكترونية للمعلمين

## الوصف
تم إنشاء نظام شامل لتذكير المعلمين بإضافة أرقام المحافظ الإلكترونية عند تسجيل الدخول أو إنشاء حساب جديد. هذا النظام يعمل على كل من واجهة الموبايل والويب العادية.

## الملفات المُضافة/المُعدلة

### 1. ملف النافذة المنبثقة
- **المسار**: `templates/components/wallet_modal.html`
- **الوصف**: نافذة منبثقة جميلة وسريعة الاستجابة لإضافة أرقام المحافظ
- **المميزات**:
  - تصميم متجاوب للموبايل والديسكتوب
  - تحقق من صحة أرقام المحافظ
  - إمكانية إضافة رقمين للمحفظة
  - خيار التخطي مع نافذة تأكيد

### 2. Routes الجديدة في auth.py
- **`/auth/update-wallet-numbers`**: تحديث أرقام المحافظ للمعلم
- **`/auth/check-wallet-status`**: فحص حالة المحفظة للمستخدم الحالي
- **`/components/wallet-modal`**: إرجاع HTML الخاص بنافذة المحفظة

### 3. تعديل صفحات المصادقة
- **تسجيل الدخول (موبايل)**: `templates/auth/auth-mobile/login.html`
- **تسجيل الدخول (عادي)**: `templates/auth/login.html`
- **التسجيل (موبايل)**: `templates/auth/auth-mobile/register.html`
- **التسجيل (عادي)**: `templates/auth/register.html`

### 4. تعديل لوحات التحكم
- **لوحة المعلم (عادي)**: `templates/dashboard/teacher.html`
- **لوحة المعلم (موبايل)**: `templates/dashboard/mobile-theme/teacher.html`

## كيفية عمل النظام

### 1. عند التسجيل
- إذا كان المستخدم معلماً جديداً، تظهر نافذة المحفظة تلقائياً بعد إنشاء الحساب
- يمكن للمعلم إضافة أرقام المحافظ أو تخطي الخطوة

### 2. عند تسجيل الدخول
- يتم فحص حالة المحفظة للمعلم
- إذا لم يكن لديه أرقام محافظ، تظهر النافذة تلقائياً
- تظهر بعد رسالة نجاح تسجيل الدخول

### 3. في لوحة التحكم
- يظهر تنبيه دائم للمعلمين الذين لم يضيفوا أرقام المحافظ
- يمكن إخفاء التنبيه مؤقتاً أو إضافة الأرقام مباشرة

## المميزات التقنية

### 1. التحقق من البيانات
- فحص تنسيق رقم المحفظة (01xxxxxxxxx)
- رقم واحد مطلوب، والثاني اختياري
- رسائل خطأ واضحة ومفيدة

### 2. الأمان
- حماية CSRF
- فحص صلاحيات المستخدم (معلم فقط)
- تحديث آمن للبيانات في قاعدة البيانات

### 3. تجربة المستخدم
- تصميم جذاب ومتجاوب
- رسائل نجاح وخطأ واضحة
- إمكانية التخطي دون إجبار
- تذكير مستمر في لوحة التحكم

### 4. الأداء
- تحميل النافذة عند الحاجة فقط
- استخدام fetch API للتحديث
- حركات سلسة ومتقنة

## الاستخدام

### للمطور
1. النافذة تُحمل تلقائياً عند الحاجة
2. يمكن استدعاؤها يدوياً بـ `loadWalletModal()`
3. تحديث الحالة بـ `updateWalletStatus(hasWallet)`

### للمعلم
1. تظهر النافذة عند أول تسجيل دخول
2. يمكن الوصول إليها من لوحة التحكم
3. إضافة/تعديل الأرقام من الملف الشخصي

## الفوائد

1. **زيادة معدل إكمال الملف الشخصي**: تذكير مباشر للمعلمين
2. **تحسين تجربة الطلاب**: إمكانية الدفع فور إضافة الأرقام
3. **مرونة في الاستخدام**: خيار التخطي متاح
4. **تصميم احترافي**: واجهة جذابة ومتناسقة مع النظام

## ملاحظات للصيانة

1. أرقام المحافظ محفوظة في جدول `users` في الحقول:
   - `ewallet_number_1` (مطلوب)
   - `ewallet_number_2` (اختياري)

2. دالة `has_ewallet_numbers()` في نموذج User للفحص

3. يمكن تعديل تصميم النافذة من `wallet_modal.html`

4. رسائل الخطأ والنجاح قابلة للتخصيص في routes

## التوافق
- يعمل على جميع المتصفحات الحديثة
- متوافق مع الموبايل والتابلت
- يدعم اللمس والتفاعل العادي
- يتكامل مع نظام الإشعارات الموجود

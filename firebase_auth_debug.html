<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ´Ø®ÙŠØµ Ù…ØµØ§Ø¯Ù‚Ø© Firebase</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” ØªØ´Ø®ÙŠØµ Ù…ØµØ§Ø¯Ù‚Ø© Firebase</h1>
    
    <div class="section">
        <h3>Ø­Ø§Ù„Ø© Firebase</h3>
        <div id="firebase-status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>
        <button onclick="checkFirebaseStatus()">ÙØ­Øµ Firebase</button>
    </div>
    
    <div class="section">
        <h3>Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</h3>
        <div id="auth-status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>
        <button onclick="checkAuthStatus()">ÙØ­Øµ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</button>
        <button onclick="simulateAuth()">Ù…Ø­Ø§ÙƒØ§Ø© Ù…ØµØ§Ø¯Ù‚Ø©</button>
    </div>
    
    <div class="section">
        <h3>Ø§Ø®ØªØ¨Ø§Ø± Firestore</h3>
        <div id="firestore-status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</div>
        <button onclick="testFirestore()">Ø§Ø®ØªØ¨Ø§Ø± Firestore</button>
        <button onclick="testChatMessage()">Ø§Ø®ØªØ¨Ø§Ø± Ø±Ø³Ø§Ù„Ø©</button>
    </div>

    <script src="/static/js/firebase_auth_sim.js"></script>
    <script src="/static/js/firebase_config_override.js"></script>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCB_GPRRlb6BCe1Mlv7rTIbtnD-Y3vpAj8",
            authDomain: "al-7esa.firebaseapp.com",
            projectId: "al-7esa",
            storageBucket: "al-7esa.firebasestorage.app",
            messagingSenderId: "893628750909",
            appId: "1:893628750909:web:3cd09924c12987b3ef9e54"
        };

        let app, db;
        
        window.checkFirebaseStatus = function() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                document.getElementById('firebase-status').innerHTML = 'âœ… Firebase Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­';
                document.getElementById('firebase-status').parentElement.className = 'section success';
            } catch (error) {
                document.getElementById('firebase-status').innerHTML = 'âŒ Ø®Ø·Ø£ Firebase: ' + error.message;
                document.getElementById('firebase-status').parentElement.className = 'section error';
            }
        }

        window.checkAuthStatus = function() {
            if (FirebaseAuthSimulator) {
                document.getElementById('auth-status').innerHTML = 'âœ… Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù…ØªÙˆÙØ±';
                document.getElementById('auth-status').parentElement.className = 'section success';
            } else {
                document.getElementById('auth-status').innerHTML = 'âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø¯Ù‚Ø©';
                document.getElementById('auth-status').parentElement.className = 'section error';
            }
        }

        window.simulateAuth = function() {
            if (FirebaseAuthSimulator) {
                FirebaseAuthSimulator.signInAnonymously().then(() => {
                    document.getElementById('auth-status').innerHTML = 'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ';
                    document.getElementById('auth-status').parentElement.className = 'section success';
                });
            }
        }

        window.testFirestore = async function() {
            try {
                const testDoc = await addDoc(collection(db, 'auth_test'), {
                    message: 'Ø§Ø®ØªØ¨Ø§Ø± Ù…ØµØ§Ø¯Ù‚Ø©',
                    timestamp: serverTimestamp(),
                    user: FirebaseAuthSimulator ? FirebaseAuthSimulator.currentUser.uid : 'anonymous'
                });
                
                document.getElementById('firestore-status').innerHTML = 'âœ… Firestore ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­';
                document.getElementById('firestore-status').parentElement.className = 'section success';
                
            } catch (error) {
                document.getElementById('firestore-status').innerHTML = 'âŒ Ø®Ø·Ø£ Firestore: ' + error.message;
                document.getElementById('firestore-status').parentElement.className = 'section error';
            }
        }

        window.testChatMessage = async function() {
            try {
                await addDoc(collection(db, 'classrooms', 'test', 'messages'), {
                    text: 'Ø±Ø³Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©',
                    senderId: 'test_user',
                    senderName: 'Ù…Ø³ØªØ®Ø¯Ù… Ø§Ø®ØªØ¨Ø§Ø±',
                    timestamp: serverTimestamp(),
                    type: 'test'
                });
                
                alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!');
                
            } catch (error) {
                alert('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ' + error.message);
            }
        }

        // ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        setTimeout(() => {
            checkFirebaseStatus();
            checkAuthStatus();
        }, 1000);
    </script>
</body>
</html>